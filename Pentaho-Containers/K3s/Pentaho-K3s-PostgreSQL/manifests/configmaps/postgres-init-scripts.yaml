apiVersion: v1
data:
  1_create_jcr_postgresql.sql: |
    --
    -- note: this script assumes pg_hba.conf is configured correctly
    --

    -- \connect postgres postgres

    drop database if exists jackrabbit;
    drop user if exists jcr_user;

    CREATE USER jcr_user PASSWORD 'password';

    CREATE DATABASE jackrabbit WITH OWNER = jcr_user ENCODING = 'UTF8' TABLESPACE = pg_default;

    GRANT ALL PRIVILEGES ON DATABASE jackrabbit to jcr_user;
  2_create_quartz_postgresql.sql: |-
    --Begin--
    -- note: this script assumes pg_hba.conf is configured correctly
    --

    \connect postgres postgres
    --Create pentaho_user if it does not exist
    DO
    $do$
    BEGIN
        IF EXISTS (
            SELECT FROM pg_catalog.pg_roles
            WHERE  rolname = 'pentaho_user') THEN

          RAISE NOTICE 'Role "pentaho_user" already exists. Skipping.';
    ELSE
    CREATE ROLE pentaho_user LOGIN PASSWORD 'password';
    END IF;
    END
    $do$;

    -- create quartz database if it does not exist
    SELECT 'CREATE DATABASE quartz WITH OWNER = pentaho_user ENCODING = ''UTF8'' TABLESPACE = pg_default;'
    WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = 'quartz')\gexec
    GRANT ALL ON DATABASE quartz to pentaho_user;
    -- Next psql line will prompt for quartz password.  There is no way to specify it without knowing the hostname
    \connect quartz pentaho_user
    -- We are now logged into the quartz database as pentaho_user
    begin;

    DROP TABLE IF EXISTS QRTZ6_FIRED_TRIGGERS;
    DROP TABLE IF EXISTS QRTZ6_PAUSED_TRIGGER_GRPS;
    DROP TABLE IF EXISTS QRTZ6_SCHEDULER_STATE;
    DROP TABLE IF EXISTS QRTZ6_LOCKS;
    DROP TABLE IF EXISTS QRTZ6_SIMPLE_TRIGGERS;
    DROP TABLE IF EXISTS QRTZ6_CRON_TRIGGERS;
    DROP TABLE IF EXISTS QRTZ6_SIMPROP_TRIGGERS;
    DROP TABLE IF EXISTS QRTZ6_BLOB_TRIGGERS;
    DROP TABLE IF EXISTS QRTZ6_TRIGGERS;
    DROP TABLE IF EXISTS QRTZ6_JOB_DETAILS;
    DROP TABLE IF EXISTS QRTZ6_CALENDARS;

    CREATE TABLE QRTZ6_JOB_DETAILS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        JOB_NAME VARCHAR(200) NOT NULL,
        JOB_GROUP VARCHAR(200) NOT NULL,
        DESCRIPTION VARCHAR(250) NULL,
        JOB_CLASS_NAME VARCHAR(250) NOT NULL,
        IS_DURABLE BOOLEAN NOT NULL,
        IS_NONCONCURRENT BOOLEAN NOT NULL,
        IS_UPDATE_DATA BOOLEAN NOT NULL,
        REQUESTS_RECOVERY BOOLEAN NOT NULL,
        JOB_DATA BYTEA NULL,
        PRIMARY KEY (SCHED_NAME, JOB_NAME, JOB_GROUP)
    );

    CREATE TABLE QRTZ6_TRIGGERS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        TRIGGER_NAME VARCHAR(200) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        JOB_NAME VARCHAR(200) NOT NULL,
        JOB_GROUP VARCHAR(200) NOT NULL,
        DESCRIPTION VARCHAR(250) NULL,
        NEXT_FIRE_TIME BIGINT NULL,
        PREV_FIRE_TIME BIGINT NULL,
        PRIORITY INTEGER NULL,
        TRIGGER_STATE VARCHAR(16) NOT NULL,
        TRIGGER_TYPE VARCHAR(8) NOT NULL,
        START_TIME BIGINT NOT NULL,
        END_TIME BIGINT NULL,
        CALENDAR_NAME VARCHAR(200) NULL,
        MISFIRE_INSTR SMALLINT NULL,
        JOB_DATA BYTEA NULL,
        PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
        FOREIGN KEY (SCHED_NAME, JOB_NAME, JOB_GROUP)
            REFERENCES QRTZ6_JOB_DETAILS (SCHED_NAME, JOB_NAME, JOB_GROUP)
    );

    CREATE TABLE QRTZ6_SIMPLE_TRIGGERS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        TRIGGER_NAME VARCHAR(200) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        REPEAT_COUNT BIGINT NOT NULL,
        REPEAT_INTERVAL BIGINT NOT NULL,
        TIMES_TRIGGERED BIGINT NOT NULL,
        PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
        FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
    );

    CREATE TABLE QRTZ6_CRON_TRIGGERS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        TRIGGER_NAME VARCHAR(200) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        CRON_EXPRESSION VARCHAR(120) NOT NULL,
        TIME_ZONE_ID VARCHAR(80),
        PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
        FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
    );

    CREATE TABLE QRTZ6_SIMPROP_TRIGGERS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        TRIGGER_NAME VARCHAR(200) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        STR_PROP_1 VARCHAR(512) NULL,
        STR_PROP_2 VARCHAR(512) NULL,
        STR_PROP_3 VARCHAR(512) NULL,
        INT_PROP_1 INTEGER NULL,
        INT_PROP_2 INTEGER NULL,
        LONG_PROP_1 BIGINT NULL,
        LONG_PROP_2 BIGINT NULL,
        DEC_PROP_1 NUMERIC(13,4) NULL,
        DEC_PROP_2 NUMERIC(13,4) NULL,
        BOOL_PROP_1 BOOLEAN NULL,
        BOOL_PROP_2 BOOLEAN NULL,
        PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
        FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
    );

    CREATE TABLE QRTZ6_BLOB_TRIGGERS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        TRIGGER_NAME VARCHAR(200) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        BLOB_DATA BYTEA NULL,
        PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
        FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
    );

    CREATE TABLE QRTZ6_CALENDARS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        CALENDAR_NAME VARCHAR(200) NOT NULL,
        CALENDAR BYTEA NOT NULL,
        PRIMARY KEY (SCHED_NAME, CALENDAR_NAME)
    );

    CREATE TABLE QRTZ6_PAUSED_TRIGGER_GRPS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        PRIMARY KEY (SCHED_NAME, TRIGGER_GROUP)
    );

    CREATE TABLE QRTZ6_FIRED_TRIGGERS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        ENTRY_ID VARCHAR(95) NOT NULL,
        TRIGGER_NAME VARCHAR(200) NOT NULL,
        TRIGGER_GROUP VARCHAR(200) NOT NULL,
        INSTANCE_NAME VARCHAR(200) NOT NULL,
        FIRED_TIME BIGINT NOT NULL,
        SCHED_TIME BIGINT NOT NULL,
        PRIORITY INTEGER NOT NULL,
        STATE VARCHAR(16) NOT NULL,
        JOB_NAME VARCHAR(200) NULL,
        JOB_GROUP VARCHAR(200) NULL,
        IS_NONCONCURRENT BOOLEAN NULL,
        REQUESTS_RECOVERY BOOLEAN NULL,
        PRIMARY KEY (SCHED_NAME, ENTRY_ID)
    );

    CREATE TABLE QRTZ6_SCHEDULER_STATE
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        INSTANCE_NAME VARCHAR(200) NOT NULL,
        LAST_CHECKIN_TIME BIGINT NOT NULL,
        CHECKIN_INTERVAL BIGINT NOT NULL,
        PRIMARY KEY (SCHED_NAME, INSTANCE_NAME)
    );

    CREATE TABLE QRTZ6_LOCKS
    (
        SCHED_NAME VARCHAR(120) NOT NULL,
        LOCK_NAME VARCHAR(40) NOT NULL,
        PRIMARY KEY (SCHED_NAME, LOCK_NAME)
    );

    INSERT INTO QRTZ6_LOCKS values('PentahoQuartzScheduler','TRIGGER_ACCESS');
    INSERT INTO QRTZ6_LOCKS values('PentahoQuartzScheduler','JOB_ACCESS');
    INSERT INTO QRTZ6_LOCKS values('PentahoQuartzScheduler','CALENDAR_ACCESS');
    INSERT INTO QRTZ6_LOCKS values('PentahoQuartzScheduler','STATE_ACCESS');
    INSERT INTO QRTZ6_LOCKS values('PentahoQuartzScheduler','MISFIRE_ACCESS');

    CREATE INDEX IDX_QRTZ6_J_REQ_RECOVERY
        ON QRTZ6_JOB_DETAILS (SCHED_NAME, REQUESTS_RECOVERY);
    CREATE INDEX IDX_QRTZ6_J_GRP
        ON QRTZ6_JOB_DETAILS (SCHED_NAME, JOB_GROUP);

    CREATE INDEX IDX_QRTZ6_T_J
        ON QRTZ6_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);
    CREATE INDEX IDX_QRTZ6_T_JG
        ON QRTZ6_TRIGGERS (SCHED_NAME, JOB_GROUP);
    CREATE INDEX IDX_QRTZ6_T_C
        ON QRTZ6_TRIGGERS (SCHED_NAME, CALENDAR_NAME);
    CREATE INDEX IDX_QRTZ6_T_G
        ON QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);
    CREATE INDEX IDX_QRTZ6_T_STATE
        ON QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_STATE);
    CREATE INDEX IDX_QRTZ6_T_N_STATE
        ON QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP, TRIGGER_STATE);
    CREATE INDEX IDX_QRTZ6_T_N_G_STATE
        ON QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_GROUP, TRIGGER_STATE);
    CREATE INDEX IDX_QRTZ6_T_NEXT_FIRE_TIME
        ON QRTZ6_TRIGGERS (SCHED_NAME, NEXT_FIRE_TIME);
    CREATE INDEX IDX_QRTZ6_T_NFT_ST
        ON QRTZ6_TRIGGERS (SCHED_NAME, TRIGGER_STATE, NEXT_FIRE_TIME);


    CREATE INDEX IDX_QRTZ6_T_NFT_MISFIRE
        ON QRTZ6_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME);
    CREATE INDEX IDX_QRTZ6_T_NFT_ST_MISFIRE
        ON QRTZ6_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_STATE);
    CREATE INDEX IDX_QRTZ6_T_NFT_ST_MISFIRE_GRP
        ON QRTZ6_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_GROUP, TRIGGER_STATE);

    CREATE INDEX IDX_QRTZ6_FT_TRIG_INST_NAME
        ON QRTZ6_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME);
    CREATE INDEX IDX_QRTZ6_FT_INST_JOB_REQ_RCVRY
        ON QRTZ6_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME, REQUESTS_RECOVERY);
    CREATE INDEX IDX_QRTZ6_FT_J_G
        ON QRTZ6_FIRED_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);
    CREATE INDEX IDX_QRTZ6_FT_JG
        ON QRTZ6_FIRED_TRIGGERS (SCHED_NAME, JOB_GROUP);
    CREATE INDEX IDX_QRTZ6_FT_T_G
        ON QRTZ6_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP);
    CREATE INDEX IDX_QRTZ6_FT_TG
        ON QRTZ6_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);

    ALTER TABLE qrtz6_fired_triggers OWNER TO pentaho_user;
    ALTER TABLE qrtz6_paused_trigger_grps OWNER TO pentaho_user;
    ALTER TABLE qrtz6_scheduler_state OWNER TO pentaho_user;
    ALTER TABLE qrtz6_locks OWNER TO pentaho_user;
    ALTER TABLE qrtz6_simple_triggers OWNER TO pentaho_user;
    ALTER TABLE qrtz6_cron_triggers OWNER TO pentaho_user;
    ALTER TABLE qrtz6_blob_triggers OWNER TO pentaho_user;
    ALTER TABLE qrtz6_simprop_triggers OWNER TO pentaho_user;
    ALTER TABLE qrtz6_triggers OWNER TO pentaho_user;
    ALTER TABLE qrtz6_job_details OWNER TO pentaho_user;
    ALTER TABLE qrtz6_calendars OWNER TO pentaho_user;

    commit;
    --End Connect--
  3_create_repository_postgresql.sql: |
    --
    -- note: this script assumes pg_hba.conf is configured correctly
    --

    -- \connect postgres postgres

    drop database if exists hibernate;
    drop user if exists hibuser;

    CREATE USER hibuser PASSWORD 'password';

    CREATE DATABASE hibernate WITH OWNER = hibuser ENCODING = 'UTF8' TABLESPACE = pg_default;

    GRANT ALL PRIVILEGES ON DATABASE hibernate to hibuser;
  4_pentaho_logging_postgresql.sql: |
    --
    -- These queries create OLTP logging tables for a PostgreSQL database
    --
    \connect hibernate hibuser

    CREATE SCHEMA pentaho_dilogs;

    -- Job log table
    --

    CREATE TABLE pentaho_dilogs.job_logs
    (
      ID_JOB INTEGER
    , CHANNEL_ID VARCHAR(255)
    , JOBNAME VARCHAR(255)
    , STATUS VARCHAR(15)
    , LINES_READ BIGINT
    , LINES_WRITTEN BIGINT
    , LINES_UPDATED BIGINT
    , LINES_INPUT BIGINT
    , LINES_OUTPUT BIGINT
    , LINES_REJECTED BIGINT
    , ERRORS BIGINT
    , STARTDATE TIMESTAMP
    , ENDDATE TIMESTAMP
    , LOGDATE TIMESTAMP
    , DEPDATE TIMESTAMP
    , REPLAYDATE TIMESTAMP
    , LOG_FIELD TEXT
    , EXECUTING_SERVER VARCHAR(255)
    , EXECUTING_USER VARCHAR(255)
    , START_JOB_ENTRY VARCHAR(255)
    , CLIENT VARCHAR(255)
    )
    ;
    CREATE INDEX IDX_job_logs_1 ON pentaho_dilogs.job_logs(ID_JOB)
    ;
    CREATE INDEX IDX_job_logs_2 ON pentaho_dilogs.job_logs(ERRORS, STATUS, JOBNAME)
    ;


    -- Job entry log table
    --

    CREATE TABLE pentaho_dilogs.jobentry_logs
    (
      ID_BATCH INTEGER
    , CHANNEL_ID VARCHAR(255)
    , LOG_DATE TIMESTAMP
    , TRANSNAME VARCHAR(255)
    , STEPNAME VARCHAR(255)
    , LINES_READ BIGINT
    , LINES_WRITTEN BIGINT
    , LINES_UPDATED BIGINT
    , LINES_INPUT BIGINT
    , LINES_OUTPUT BIGINT
    , LINES_REJECTED BIGINT
    , ERRORS BIGINT
    , "RESULT" CHAR(5)
    , NR_RESULT_ROWS BIGINT
    , NR_RESULT_FILES BIGINT
    , LOG_FIELD TEXT
    , COPY_NR INTEGER
    )
    ;
    CREATE INDEX IDX_jobentry_logs_1 ON pentaho_dilogs.jobentry_logs(ID_BATCH)
    ;


    -- Logging channel log table
    --

    CREATE TABLE pentaho_dilogs.channel_logs
    (
      ID_BATCH INTEGER
    , CHANNEL_ID VARCHAR(255)
    , LOG_DATE TIMESTAMP
    , LOGGING_OBJECT_TYPE VARCHAR(255)
    , OBJECT_NAME VARCHAR(255)
    , OBJECT_COPY VARCHAR(255)
    , REPOSITORY_DIRECTORY VARCHAR(255)
    , FILENAME VARCHAR(255)
    , OBJECT_ID VARCHAR(255)
    , OBJECT_REVISION VARCHAR(255)
    , PARENT_CHANNEL_ID VARCHAR(255)
    , ROOT_CHANNEL_ID VARCHAR(255)
    )
    ;
    CREATE TABLE pentaho_dilogs.checkpoint_logs
    (
      ID_JOB_RUN INTEGER
    , ID_JOB INTEGER
    , JOBNAME VARCHAR(255)
    , NAMESPACE VARCHAR(255)
    , CHECKPOINT_NAME VARCHAR(255)
    , CHECKPOINT_COPYNR SMALLINT
    , ATTEMPT_NR INTEGER
    , JOB_RUN_START_DATE TIMESTAMP
    , LOGDATE TIMESTAMP
    , RESULT_XML TEXT
    , PARAMETER_XML TEXT
    )
    ;
    CREATE INDEX IDX_checkpoint_logs_1 ON pentaho_dilogs.checkpoint_logs(ID_JOB_RUN)
    ;
    CREATE INDEX IDX_checkpoint_logs_2 ON pentaho_dilogs.checkpoint_logs(JOBNAME, NAMESPACE)
    ;


    -- Transformation log table
    --

    CREATE TABLE pentaho_dilogs.trans_logs
    (
      ID_BATCH INTEGER
    , CHANNEL_ID VARCHAR(255)
    , TRANSNAME VARCHAR(255)
    , STATUS VARCHAR(15)
    , LINES_READ BIGINT
    , LINES_WRITTEN BIGINT
    , LINES_UPDATED BIGINT
    , LINES_INPUT BIGINT
    , LINES_OUTPUT BIGINT
    , LINES_REJECTED BIGINT
    , ERRORS BIGINT
    , STARTDATE TIMESTAMP
    , ENDDATE TIMESTAMP
    , LOGDATE TIMESTAMP
    , DEPDATE TIMESTAMP
    , REPLAYDATE TIMESTAMP
    , LOG_FIELD TEXT
    , EXECUTING_SERVER VARCHAR(255)
    , EXECUTING_USER VARCHAR(255)
    , CLIENT VARCHAR(255)
    )
    ;
    CREATE INDEX IDX_trans_logs_1 ON pentaho_dilogs.trans_logs(ID_BATCH)
    ;
    CREATE INDEX IDX_trans_logs_2 ON pentaho_dilogs.trans_logs(ERRORS, STATUS, TRANSNAME)
    ;


    -- Step log table
    --

    CREATE TABLE pentaho_dilogs.step_logs
    (
      ID_BATCH INTEGER
    , CHANNEL_ID VARCHAR(255)
    , LOG_DATE TIMESTAMP
    , TRANSNAME VARCHAR(255)
    , STEPNAME VARCHAR(255)
    , STEP_COPY SMALLINT
    , LINES_READ BIGINT
    , LINES_WRITTEN BIGINT
    , LINES_UPDATED BIGINT
    , LINES_INPUT BIGINT
    , LINES_OUTPUT BIGINT
    , LINES_REJECTED BIGINT
    , ERRORS BIGINT
    , LOG_FIELD TEXT
    )
    ;


    -- Step performance log table
    --

    CREATE TABLE pentaho_dilogs.transperf_logs
    (
      ID_BATCH INTEGER
    , SEQ_NR INTEGER
    , LOGDATE TIMESTAMP
    , TRANSNAME VARCHAR(255)
    , STEPNAME VARCHAR(255)
    , STEP_COPY INTEGER
    , LINES_READ BIGINT
    , LINES_WRITTEN BIGINT
    , LINES_UPDATED BIGINT
    , LINES_INPUT BIGINT
    , LINES_OUTPUT BIGINT
    , LINES_REJECTED BIGINT
    , ERRORS BIGINT
    , INPUT_BUFFER_ROWS BIGINT
    , OUTPUT_BUFFER_ROWS BIGINT
    )
    ;


    -- Metrics log table
    --

    CREATE TABLE pentaho_dilogs.metrics_logs
    (
      ID_BATCH INTEGER
    , CHANNEL_ID VARCHAR(255)
    , LOG_DATE TIMESTAMP
    , METRICS_DATE TIMESTAMP
    , METRICS_CODE VARCHAR(255)
    , METRICS_DESCRIPTION VARCHAR(255)
    , METRICS_SUBJECT VARCHAR(255)
    , METRICS_TYPE VARCHAR(255)
    , METRICS_VALUE BIGINT
    )
    ;
  5_pentaho_mart_postgresql.sql: |+
    --
    -- These queries create logging datamart tables for a PostGreSQL database
    --
    \connect hibernate hibuser

    CREATE SCHEMA pentaho_operations_mart;

    --
    -- SHARED between BA & DI Data Mart - pentaho_operations_mart.DIM_DATE
    --

    CREATE TABLE  pentaho_operations_mart.DIM_DATE (
      date_tk int,
      date_field TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      ymd varchar(10) DEFAULT NULL,
      ym varchar(7) DEFAULT NULL,
      year int DEFAULT NULL,
      quarter int DEFAULT NULL,
      quarter_code varchar(2) DEFAULT NULL,
      month int DEFAULT NULL,
      month_desc varchar(20) DEFAULT NULL,
      month_code varchar(15) DEFAULT NULL,
      day int DEFAULT NULL,
      day_of_year int DEFAULT NULL,
      day_of_week int DEFAULT NULL,
      day_of_week_desc varchar(20) DEFAULT NULL,
      day_of_week_code varchar(15) DEFAULT NULL,
      week int DEFAULT NULL,
      PRIMARY KEY (date_tk)
    );
    CREATE INDEX IDX_DIM_DATE_DATE_TK ON pentaho_operations_mart.DIM_DATE (date_tk);

    --
    -- SHARED between BA & DI Data Mart - pentaho_operations_mart.DIM_TIME
    --

    CREATE TABLE  pentaho_operations_mart.DIM_TIME (
      time_tk int,
      hms varchar(8) DEFAULT NULL,
      hm varchar(5) DEFAULT NULL,
      ampm varchar(8) DEFAULT NULL,
      hour int DEFAULT NULL,
      hour12 int DEFAULT NULL,
      minute int DEFAULT NULL,
      second int DEFAULT NULL,
      PRIMARY KEY (time_tk)
    );
    CREATE INDEX IDX_DIM_TIME_TIME_TK ON pentaho_operations_mart.DIM_TIME(time_tk);

    --
    -- DI Data Mart - pentaho_operations_mart.DIM_BATCH
    --

    CREATE TABLE  pentaho_operations_mart.DIM_BATCH (
      batch_tk bigint,
      batch_id bigint DEFAULT NULL,
      logchannel_id varchar(100) DEFAULT NULL,
      parent_logchannel_id varchar(100) DEFAULT NULL,
      PRIMARY KEY (batch_tk)
    );
    CREATE INDEX IDX_DIM_BATCH_BATCH_TK ON pentaho_operations_mart.DIM_BATCH (batch_tk);
    CREATE INDEX IDX_DIM_BATCH_LOOKUP ON pentaho_operations_mart.DIM_BATCH (batch_id,logchannel_id,parent_logchannel_id);

    --
    -- DI Data Mart - pentaho_operations_mart.DIM_EXECUTION
    --

    CREATE TABLE  pentaho_operations_mart.DIM_EXECUTION (
      execution_tk bigint,
      execution_id varchar(100) DEFAULT NULL,
      server_host varchar(100) DEFAULT NULL,
      executing_user varchar(100) DEFAULT NULL,
      execution_status varchar(30) DEFAULT NULL,
      client varchar(255) DEFAULT NULL
    );
    CREATE INDEX IDX_DIM_EXECUTION_EXECUTION_TK ON pentaho_operations_mart.DIM_EXECUTION(execution_tk);
    CREATE INDEX IDX_DIM_EXECUTION_LOOKUP ON pentaho_operations_mart.DIM_EXECUTION(execution_id,server_host,executing_user,client);

    --
    -- DI Data Mart - pentaho_operations_mart.DIM_EXECUTOR
    --

    CREATE TABLE  pentaho_operations_mart.DIM_EXECUTOR (
      executor_tk bigint,
      version int DEFAULT NULL,
      date_from TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      date_to TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      executor_id varchar(255) DEFAULT NULL,
      executor_source varchar(255) DEFAULT NULL,
      executor_environment varchar(255) DEFAULT NULL,
      executor_type varchar(255) DEFAULT NULL,
      executor_name varchar(255) DEFAULT NULL,
      executor_desc varchar(255) DEFAULT NULL,
      executor_revision varchar(255) DEFAULT NULL,
      executor_version_label varchar(255) DEFAULT NULL,
      exec_enabled_table_logging char(1) DEFAULT NULL,
      exec_enabled_detailed_logging char(1) DEFAULT NULL,
      exec_enabled_perf_logging char(1) DEFAULT NULL,
      exec_enabled_history_logging char(1) DEFAULT NULL,
      last_updated_date TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      last_updated_user varchar(255) DEFAULT NULL,
      PRIMARY KEY (executor_tk)
    );
    CREATE INDEX IDX_DIM_EXECUTOR_executor_tk ON pentaho_operations_mart.DIM_EXECUTOR(executor_tk);
    CREATE INDEX IDX_DIM_EXECUTOR_LOOKUP ON pentaho_operations_mart.DIM_EXECUTOR(executor_id);

    --
    -- DI Data Mart - pentaho_operations_mart.DIM_LOG_TABLE
    --

    CREATE TABLE pentaho_operations_mart.DIM_LOG_TABLE
    (
      log_table_tk bigint,
      object_type VARCHAR(30) DEFAULT NULL,
      table_connection_name VARCHAR(255) DEFAULT NULL,
      table_name VARCHAR(255) DEFAULT NULL,
      schema_name VARCHAR(255) DEFAULT NULL,
      step_entry_table_conn_name VARCHAR(255) DEFAULT NULL,
      step_entry_table_name VARCHAR(255) DEFAULT NULL,
      step_entry_schema_name VARCHAR(255) DEFAULT NULL,
      perf_table_conn_name varchar(255) DEFAULT NULL,
      perf_table_name varchar(255) DEFAULT NULL,
      perf_schema_name varchar(255) DEFAULT NULL,
      PRIMARY KEY (log_table_tk)
    );
    CREATE UNIQUE INDEX idx_DIM_LOG_TABLE_pk ON pentaho_operations_mart.DIM_LOG_TABLE(log_table_tk);
    CREATE INDEX idx_DIM_LOG_TABLE_lookup  ON pentaho_operations_mart.DIM_LOG_TABLE(object_type, table_connection_name, table_name, schema_name);
    CREATE INDEX idx_DIM_LOG_STEP_ENTRY_lookup  ON pentaho_operations_mart.DIM_LOG_TABLE(object_type, step_entry_table_conn_name, step_entry_table_name, step_entry_schema_name);
    CREATE INDEX idx_DIM_LOG_PERF_ENTRY_lookup  ON pentaho_operations_mart.DIM_LOG_TABLE(object_type, perf_table_conn_name, perf_table_name, perf_schema_name);

    --
    -- DI Data Mart - pentaho_operations_mart.DIM_STEP
    --

    CREATE TABLE pentaho_operations_mart.DIM_STEP
    (
      step_tk bigint,
      step_id varchar(255) DEFAULT NULL,
      original_step_name varchar(255) DEFAULT NULL,
      PRIMARY KEY (step_tk)
    );
    CREATE INDEX IDX_DIM_STEP_step_tk ON pentaho_operations_mart.DIM_STEP(step_tk);
    CREATE INDEX IDX_DIM_STEP_LOOKUP ON pentaho_operations_mart.DIM_STEP(step_id);

    --
    -- DI Data Mart - pentaho_operations_mart.FACT_EXECUTION
    --

    CREATE TABLE  pentaho_operations_mart.FACT_EXECUTION (
      execution_date_tk int DEFAULT NULL,
      execution_time_tk int DEFAULT NULL,
      batch_tk bigint DEFAULT NULL,
      execution_tk bigint DEFAULT NULL,
      executor_tk bigint DEFAULT NULL,
      parent_executor_tk bigint DEFAULT NULL,
      root_executor_tk bigint DEFAULT NULL,
      execution_timestamp TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      duration double precision DEFAULT NULL,
      rows_input bigint DEFAULT NULL,
      rows_output bigint DEFAULT NULL,
      rows_read bigint DEFAULT NULL,
      rows_written bigint DEFAULT NULL,
      rows_rejected bigint DEFAULT NULL,
      errors bigint DEFAULT NULL,
      failed smallint DEFAULT NULL
    );
    CREATE INDEX IDX_FACT_EXECUTION_EXECUTION_DATE_TK ON pentaho_operations_mart.FACT_EXECUTION(execution_date_tk);
    CREATE INDEX IDX_FACT_EXECUTION_EXECUTION_TIME_TK ON pentaho_operations_mart.FACT_EXECUTION(execution_time_tk);
    CREATE INDEX IDX_FACT_EXECUTION_BATCH_TK ON pentaho_operations_mart.FACT_EXECUTION(batch_tk);
    CREATE INDEX IDX_FACT_EXECUTION_EXECUTION_TK ON pentaho_operations_mart.FACT_EXECUTION(execution_tk);
    CREATE INDEX IDX_FACT_EXECUTION_EXECUTOR_TK ON pentaho_operations_mart.FACT_EXECUTION(executor_tk);
    CREATE INDEX IDX_FACT_EXECUTION_PARENT_EXECUTOR_TK ON pentaho_operations_mart.FACT_EXECUTION(parent_executor_tk);
    CREATE INDEX IDX_FACT_EXECUTION_ROOT_EXECUTOR_TK ON pentaho_operations_mart.FACT_EXECUTION(root_executor_tk);

    --
    -- DI Data Mart - pentaho_operations_mart.FACT_STEP_EXECUTION
    --

    CREATE TABLE  pentaho_operations_mart.FACT_STEP_EXECUTION (
      execution_date_tk int DEFAULT NULL,
      execution_time_tk int DEFAULT NULL,
      batch_tk bigint DEFAULT NULL,
      executor_tk bigint DEFAULT NULL,
      parent_executor_tk bigint DEFAULT NULL,
      root_executor_tk bigint DEFAULT NULL,
      step_tk bigint DEFAULT NULL,
      step_copy int DEFAULT NULL,
      execution_timestamp TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      rows_input bigint DEFAULT NULL,
      rows_output bigint DEFAULT NULL,
      rows_read bigint DEFAULT NULL,
      rows_written bigint DEFAULT NULL,
      rows_rejected bigint DEFAULT NULL,
      errors bigint DEFAULT NULL
    );
    CREATE INDEX IDX_FACT_STEP_EXECUTION_EXECUTION_DATE_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(execution_date_tk);
    CREATE INDEX IDX_FACT_STEP_EXECUTION_EXECUTION_TIME_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(execution_time_tk);
    CREATE INDEX IDX_FACT_STEP_EXECUTION_BATCH_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(batch_tk);
    CREATE INDEX IDX_FACT_STEP_EXECUTION_EXECUTOR_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(executor_tk);
    CREATE INDEX IDX_FACT_STEP_EXECUTION_PARENT_EXECUTOR_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(parent_executor_tk);
    CREATE INDEX IDX_FACT_STEP_EXECUTION_ROOT_EXECUTOR_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(root_executor_tk);
    CREATE INDEX IDX_FACT_STEP_EXECUTION_STEP_TK ON pentaho_operations_mart.FACT_STEP_EXECUTION(step_tk);

    --
    -- DI Data Mart - pentaho_operations_mart.FACT_JOBENTRY_EXECUTION
    --

    CREATE TABLE  pentaho_operations_mart.FACT_JOBENTRY_EXECUTION (
      execution_date_tk int DEFAULT NULL,
      execution_time_tk int DEFAULT NULL,
      batch_tk bigint DEFAULT NULL,
      executor_tk bigint DEFAULT NULL,
      parent_executor_tk bigint DEFAULT NULL,
      root_executor_tk bigint DEFAULT NULL,
      step_tk bigint DEFAULT NULL,
      execution_timestamp TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      rows_input bigint DEFAULT NULL,
      rows_output bigint DEFAULT NULL,
      rows_read bigint DEFAULT NULL,
      rows_written bigint DEFAULT NULL,
      rows_rejected bigint DEFAULT NULL,
      errors bigint DEFAULT NULL,
      result char(5) DEFAULT NULL,
      nr_result_rows bigint DEFAULT NULL,
      nr_result_files bigint DEFAULT NULL
    );
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_EXECUTION_DATE_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(execution_date_tk);
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_EXECUTION_TIME_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(execution_time_tk);
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_BATCH_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(batch_tk);
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_EXECUTOR_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(executor_tk);
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_PARENT_EXECUTOR_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(parent_executor_tk);
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_ROOT_EXECUTOR_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(root_executor_tk);
    CREATE INDEX IDX_FACT_JOBENTRY_EXECUTION_STEP_TK ON pentaho_operations_mart.FACT_JOBENTRY_EXECUTION(step_tk);

    --
    -- DI Data Mart - pentaho_operations_mart.FACT_PERF_EXECUTION
    --

    CREATE TABLE  pentaho_operations_mart.FACT_PERF_EXECUTION (
      execution_date_tk int DEFAULT NULL,
      execution_time_tk int DEFAULT NULL,
      batch_tk bigint DEFAULT NULL,
      executor_tk bigint DEFAULT NULL,
      parent_executor_tk bigint DEFAULT NULL,
      root_executor_tk bigint DEFAULT NULL,
      step_tk bigint DEFAULT NULL,
      seq_nr bigint DEFAULT NULL,
      step_copy bigint DEFAULT NULL,
      execution_timestamp TIMESTAMP WITHOUT TIME ZONE DEFAULT NULL,
      rows_input bigint DEFAULT NULL,
      rows_output bigint DEFAULT NULL,
      rows_read bigint DEFAULT NULL,
      rows_written bigint DEFAULT NULL,
      rows_rejected bigint DEFAULT NULL,
      errors bigint DEFAULT NULL,
      input_buffer_rows bigint DEFAULT NULL,
      output_buffer_rows bigint DEFAULT NULL
    );
    CREATE INDEX IDX_FACT_PERF_EXECUTION_EXECUTION_DATE_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(execution_date_tk);
    CREATE INDEX IDX_FACT_PERF_EXECUTION_EXECUTION_TIME_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(execution_time_tk);
    CREATE INDEX IDX_FACT_PERF_EXECUTION_BATCH_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(batch_tk);
    CREATE INDEX IDX_FACT_PERF_EXECUTION_EXECUTOR_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(executor_tk);
    CREATE INDEX IDX_FACT_PERF_EXECUTION_PARENT_EXECUTOR_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(parent_executor_tk);
    CREATE INDEX IDX_FACT_PERF_EXECUTION_ROOT_EXECUTOR_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(root_executor_tk);
    CREATE INDEX IDX_FACT_PERF_EXECUTION_STEP_TK ON pentaho_operations_mart.FACT_PERF_EXECUTION(step_tk);


    --
    -- BA Data Mart - pentaho_operations_mart.DIM_STATE
    --

    CREATE TABLE  pentaho_operations_mart.DIM_STATE (
      state_tk bigint NOT NULL,
      state varchar(100) NOT NULL,
      PRIMARY KEY (state_tk)
    );
    CREATE INDEX IDX_DIM_STATE_STATE_TK ON pentaho_operations_mart.DIM_STATE (state_tk);

    --
    -- BA Data Mart - pentaho_operations_mart.DIM_SESSION
    --

    CREATE TABLE  pentaho_operations_mart.DIM_SESSION (
      session_tk bigint NOT NULL,
      session_id varchar(200) NOT NULL,
      session_type varchar(200) NOT NULL,
      username varchar(200) NOT NULL,
      PRIMARY KEY (session_tk)
    );
    CREATE INDEX IDX_DIM_SESSION_SESSION_TK ON pentaho_operations_mart.DIM_SESSION (session_tk);

    --
    -- BA Data Mart - pentaho_operations_mart.DIM_INSTANCE
    --

    CREATE TABLE  pentaho_operations_mart.DIM_INSTANCE (
      instance_tk bigint NOT NULL,
      instance_id varchar(200) NOT NULL,
      engine_id varchar(200) NOT NULL,
      service_id varchar(200) NOT NULL,
      content_id varchar(1024) NOT NULL,
      content_detail varchar(1024),
      PRIMARY KEY (instance_tk)
    );
    CREATE INDEX IDX_DIM_INSTANCE_INSTANCE_TK ON pentaho_operations_mart.DIM_INSTANCE (instance_tk);

    --
    -- BA Data Mart - pentaho_operations_mart.DIM_COMPONENT
    --

    CREATE TABLE  pentaho_operations_mart.DIM_COMPONENT (
      component_tk bigint NOT NULL,
      component_id varchar(200) NOT NULL,
      PRIMARY KEY (component_tk)
    );
    CREATE INDEX IDX_DIM_COMPONENT_COMPONENT_TK ON pentaho_operations_mart.DIM_COMPONENT (component_tk);

    --
    -- BA Data Mart - pentaho_operations_mart.STG_CONTENT_ITEM
    --

    CREATE TABLE pentaho_operations_mart.STG_CONTENT_ITEM (
      gid char(36) NOT NULL,
      parent_gid char(36) DEFAULT NULL,
      fileSize int NOT NULL,
      locale varchar(5) DEFAULT NULL,
      name varchar(200) NOT NULL,
      ownerType int NOT NULL,
      path varchar(1024) NOT NULL,
      title varchar(255) DEFAULT NULL,
      is_folder char(1) NOT NULL,
      is_hidden char(1) NOT NULL,
      is_locked char(1) NOT NULL,
      is_versioned char(1) NOT NULL,
      date_created timestamp DEFAULT NULL,
      date_last_modified timestamp DEFAULT NULL,
      is_processed char(1) DEFAULT NULL,
      PRIMARY KEY (gid)
    );
    CREATE INDEX IDX_STG_CONTENT_ITEM_GID ON pentaho_operations_mart.STG_CONTENT_ITEM (gid);

    --
    -- BA Data Mart - pentaho_operations_mart.DIM_CONTENT_ITEM
    --

    CREATE TABLE pentaho_operations_mart.DIM_CONTENT_ITEM (
      content_item_tk int NOT NULL,
      content_item_title VARCHAR(255) NOT NULL DEFAULT 'NA',
      content_item_locale VARCHAR(255) NOT NULL DEFAULT 'NA',
      content_item_size int NULL DEFAULT 0,
      content_item_path VARCHAR(1024) NULL DEFAULT 'NA',
      content_item_name VARCHAR(255) NOT NULL DEFAULT 'NA',
      content_item_fullname VARCHAR(1024) NOT NULL DEFAULT 'NA',
      content_item_type VARCHAR(32) NOT NULL DEFAULT 'NA',
      content_item_extension VARCHAR(32) NULL DEFAULT 'NA',
      content_item_guid CHAR(36) NOT NULL DEFAULT 'NA',
      parent_content_item_guid CHAR(36) NULL DEFAULT 'NA',
      parent_content_item_tk int NULL,
      content_item_modified timestamp NOT NULL DEFAULT '1900-01-01 00:00:00',
      content_item_valid_from timestamp NOT NULL DEFAULT '1900-01-01 00:00:00',
      content_item_valid_to timestamp NOT NULL DEFAULT '9999-12-31 23:59:59',
      content_item_state VARCHAR(16) NULL DEFAULT 'new',
      content_item_version int NOT NULL DEFAULT 0,
      PRIMARY KEY(content_item_tk)
    );
    CREATE INDEX IDX_DIM_CONTENT_ITEM_CONTENT_ITEM_TK ON pentaho_operations_mart.DIM_CONTENT_ITEM (content_item_tk);
    CREATE INDEX IDX_DIM_CONTENT_ITEM_GUID_FROM ON pentaho_operations_mart.DIM_CONTENT_ITEM (content_item_guid, content_item_valid_from);


    --
    -- BA Data Mart - pentaho_operations_mart.FACT_SESSION
    --


    CREATE TABLE  pentaho_operations_mart.FACT_SESSION (
      start_date_tk int NOT NULL,
      start_time_tk int NOT NULL,
      end_date_tk int NOT NULL,
      end_time_tk int NOT NULL,
      session_tk bigint NOT NULL,
      state_tk bigint NOT NULL,
      duration numeric(19,3) NOT NULL
    );
    CREATE INDEX IDX_FACT_PERF_SESSION_START_DATE_TK ON pentaho_operations_mart.FACT_SESSION(start_date_tk);
    CREATE INDEX IDX_FACT_PERF_SESSION_START_TIME_TK ON pentaho_operations_mart.FACT_SESSION(start_time_tk);
    CREATE INDEX IDX_FACT_PERF_SESSION_END_DATE_TK ON pentaho_operations_mart.FACT_SESSION(end_date_tk);
    CREATE INDEX IDX_FACT_PERF_SESSION_END_TIME_TK ON pentaho_operations_mart.FACT_SESSION(end_time_tk);
    CREATE INDEX IDX_FACT_PERF_SESSION_SESSION_TK ON pentaho_operations_mart.FACT_SESSION(session_tk);
    CREATE INDEX IDX_FACT_PERF_SESSION_STATE_TK ON pentaho_operations_mart.FACT_SESSION(state_tk);


    --
    -- BA Data Mart - pentaho_operations_mart.FACT_INSTANCE
    --

    CREATE TABLE  pentaho_operations_mart.FACT_INSTANCE (
      start_date_tk int NOT NULL,
      start_time_tk int NOT NULL,
      end_date_tk int NOT NULL,
      end_time_tk int NOT NULL,
      session_tk bigint NOT NULL,
      instance_tk bigint NOT NULL,
      state_tk bigint NOT NULL,
      duration numeric(19,3) NOT NULL
    );
    CREATE INDEX IDX_FACT_PERF_INSTANCE_START_DATE_TK ON pentaho_operations_mart.FACT_INSTANCE(start_date_tk);
    CREATE INDEX IDX_FACT_PERF_INSTANCE_START_TIME_TK ON pentaho_operations_mart.FACT_INSTANCE(start_time_tk);
    CREATE INDEX IDX_FACT_PERF_INSTANCE_END_DATE_TK ON pentaho_operations_mart.FACT_INSTANCE(end_date_tk);
    CREATE INDEX IDX_FACT_PERF_INSTANCE_END_TIME_TK ON pentaho_operations_mart.FACT_INSTANCE(end_time_tk);
    CREATE INDEX IDX_FACT_PERF_INSTANCE_SESSION_TK ON pentaho_operations_mart.FACT_INSTANCE(session_tk);
    CREATE INDEX IDX_FACT_PERF_INSTANCE_INSTANCE_TK ON pentaho_operations_mart.FACT_INSTANCE(instance_tk);
    CREATE INDEX IDX_FACT_PERF_INSTANCE_STATE_TK ON pentaho_operations_mart.FACT_INSTANCE(state_tk);

    --
    -- BA Data Mart - pentaho_operations_mart.FACT_COMPONENT
    --

    CREATE TABLE  pentaho_operations_mart.FACT_COMPONENT (
      start_date_tk int NOT NULL,
      start_time_tk int NOT NULL,
      end_date_tk int NOT NULL,
      end_time_tk int NOT NULL,
      session_tk bigint NOT NULL,
      instance_tk bigint NOT NULL,
      state_tk bigint NOT NULL,
      component_tk bigint NOT NULL,
      duration numeric(19,3) NOT NULL
    );
    CREATE INDEX IDX_FACT_PERF_COMPONENT_START_DATE_TK ON pentaho_operations_mart.FACT_COMPONENT(start_date_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_START_TIME_TK ON pentaho_operations_mart.FACT_COMPONENT(start_time_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_END_DATE_TK ON pentaho_operations_mart.FACT_COMPONENT(end_date_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_END_TIME_TK ON pentaho_operations_mart.FACT_COMPONENT(end_time_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_SESSION_TK ON pentaho_operations_mart.FACT_COMPONENT(session_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_INSTANCE_TK ON pentaho_operations_mart.FACT_COMPONENT(instance_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_COMPONENT_TK ON pentaho_operations_mart.FACT_COMPONENT(component_tk);
    CREATE INDEX IDX_FACT_PERF_COMPONENT_STATE_TK ON pentaho_operations_mart.FACT_COMPONENT(state_tk);

    --
    -- BA Data Mart - pentaho_operations_mart.PRO_AUDIT_STAGING
    --

    CREATE TABLE pentaho_operations_mart.PRO_AUDIT_STAGING (
       job_id varchar(200),
       inst_id varchar(200),
       obj_id varchar(1024),
       obj_type varchar(200),
       actor varchar(200),
       message_type varchar(200),
       message_name varchar(200),
       message_text_value varchar(1024),
       message_num_value numeric(19),
       duration numeric(19, 3),
       audit_time timestamp
    );
    CREATE INDEX IDX_PRO_AUDIT_STAGING_MESSAGE_TYPE ON pentaho_operations_mart.PRO_AUDIT_STAGING(message_type);

    --
    -- BA Data Mart - pentaho_operations_mart.PRO_AUDIT_TRACKER
    --

    CREATE TABLE pentaho_operations_mart.PRO_AUDIT_TRACKER (
       audit_time timestamp
    );
    CREATE INDEX IDX_PRO_AUDIT_TRACKER_AUDIT_TIME ON pentaho_operations_mart.PRO_AUDIT_STAGING(audit_time);
    INSERT INTO pentaho_operations_mart.PRO_AUDIT_TRACKER values (timestamptz 'epoch');

kind: ConfigMap
metadata:
  name: postgres-init-scripts
  namespace: pentaho
