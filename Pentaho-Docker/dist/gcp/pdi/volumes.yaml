# Namespace for grouping related resources
apiVersion: v1
kind: Namespace
metadata:
  name: pdi
---
# Persistent Volume using GCSFuse CSI driver
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pdia-pv-pdi
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteMany
  csi:
    driver: gcsfuse.csi.storage.gke.io
    volumeHandle: "pentaho-eng-dev"  # Unique ID for this PV
    volumeAttributes:
      bucketName: "pentaho-eng-dev"
      mountOptions: "implicit-dirs,uid=5000,gid=5000,file-mode=0770,dir-mode=0770"
  persistentVolumeReclaimPolicy: Retain
---
# Persistent Volume Claim to bind to the above PV
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pdia-pv-pdi
  namespace: pdi
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 10Gi
  volumeName: pdia-pv-pdi
  storageClassName: ""  # Empty for statically provisioned volumes
---

# ServiceAccount for GCS access with correct IAM binding
apiVersion: v1
kind: ServiceAccount
metadata:
  name: gcs-access-pdi
  namespace: pdi
  annotations:
    iam.gke.io/gcp-service-account: 890874994325-compute@developer.gserviceaccount.com
---

# Secret for Pentaho license (add your base64 encoded license XML)
apiVersion: v1
kind: Secret
metadata:
  name: pentaho-license
  namespace: pdi
data:
# .installedLicenses.xml: BASE64_ENCODED_LICENSE_DATA