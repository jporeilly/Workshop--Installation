# On-Prem Pentaho Server Docker Project

This project provides a Docker setup for Pentaho Server (PUC). The setup includes Dockerfiles, Docker Compose configurations, and necessary scripts to build and run Pentaho Server in a containerized environment.

## Project Structure

### `assemblies/pentaho-server/`

This folder contains resources required for building the Docker image.

- **`Dockerfile`**: The Dockerfile used to build the Pentaho Server Docker image.
- **`entrypoint/`**: Contains the entrypoint script and initialization files.
  - **`docker-entrypoint.sh`**: The entrypoint script that sets up the environment and starts the command given.
  - **`docker-entrypoint-init/`**: A folder to place any initialization files that need to be copied into the container.
- **`stagedArtifacts/`**: This folder should contain the pre-downloaded Pentaho distribution software ZIP files.
  - **`README.md`**: Instructions on what files to place in this folder.

### `dist/on-prem/pentaho-server/`

This folder contains resources and configurations for running Pentaho Server Docker container with several database variants. For this example we will use MySql database.

- **`pentaho-server-mysql/`**: Contains Docker Compose configurations for running Pentaho Server with MySql database.
  - **`docker-compose-mysql.yml`**: Docker Compose file to set up and run Pentaho Server with MySql database.
  - **`.env`**: Environment variables file for Docker Compose.

### `config/`
This folder contains configuration files for the Pentaho Server. It is mounted as a volume in the Docker container to allow customization of the server settings.

### `db_init_mysql/`
This folder should contain the database scripts which needs to be run in the RDS DB Instance.

### `logs/`
This folder is used to store logs generated by the Pentaho Server. It is mounted as a volume in the Docker container to persist logs across container restarts.

### `softwareOverride/`
This folder should contain any configuration files that need to override the default configurations in the Pentaho Server installation.


## Usage

### Prerequisites

- Docker
- Docker Compose

### Building the Docker Image

1. Navigate to the `assemblies/pentaho-server/` directory.
2. Place the required Pentaho Server distribution software ZIP files in the `assemblies/pentaho-server/stagedArtifacts/` folder.
3. Change the `Dockerfile` `ARG PENTAHO_VERSION` to the desired version of Pentaho Server.
4. Build the Docker image using the following command:
   ```sh
   docker build -t pentaho/pentaho-server:11.x .
   ```

### Running the Docker Container

1. Navigate to the `dist/on-prem/pentaho-server/pentaho-server-mysql/` directory.
2. Ensure the `.env` file is correctly configured with the necessary environment variables.
3. Start the Pentaho Server using Docker Compose:
   ```sh
   docker-compose -f docker-compose-mysql.yaml up
   ```

### Environment Variables

The `.env` file contains the following environment variables:

- `PENTAHO_VERSION`: The version of Pentaho Server to be used.
- `SOFTWARE_OVERRIDE_FOLDER`: The folder containing configuration overrides.
- `LOG_FOLDER`: The folder containing Pentaho Server log files.
- `CONFIG_FOLDER`: The folder containing configuration files.
- `PORT`: The port number to expose for the server.
- `LICENSE_URL`: The URL for the Pentaho Server licencing server.
- `DATABASE_VERSION`: The version of the database to use.
- `DATABASE_EDITION`: The database edition to use, if any.
- `DOCKER_DATABASE_IMAGE`: The docker image to use for the database.



### Additional Information

For more details on how to configure and use the Docker setup, refer to the individual README files in the respective folders.
