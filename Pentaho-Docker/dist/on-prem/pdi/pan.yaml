services:
  pdi:
    #stdin_open: true # docker run -i
    #tty: true        # docker run -t
    image: ${PENTAHO_IMAGE_NAME}:${PENTAHO_VERSION}
    platform: linux/amd64
    build:
      args:
        PENTAHO_VERSION: ${PENTAHO_VERSION}
    hostname: pan
    ports:
      - "${PORT}:8080"
    stop_grace_period: "0s"
    deploy:
      resources:
        limits:
          cpus: '3'
          memory: 4g
    volumes:
      #OVERRIDE_FOLDER is a folder that contains the software "changes" that will be copied to the container
      - "${SOFTWARE_OVERRIDE_FOLDER}/:/docker-entrypoint-init"
      
      #SOLUTION_FOLDER is a folder that contains the project solution files that will be copied to the container
      - "${SOLUTION_FOLDER}/:/opt/pentaho/solution/"

      #CONFIG_FOLDER is a folder that contains the configuration files that will be copied to the container
      - "${CONFIG_FOLDER}/:${PENTAHO_HOME}/"

      #LOG_FOLDER is a folder that contains the log files that will be generated by the container
      - "${LOG_FOLDER}:/opt/pentaho/data-integration/logs"


      #AdditionalVolumePlaceholder-Do not modify this line.
    environment:
      - PENTAHO_DI_JAVA_OPTIONS=
        -Dfile.encoding=utf8
        -XX:MinRAMPercentage=50.0 
        -XX:MaxRAMPercentage=75.0
        -XX:+UseG1GC 
      - LICENSE_URL=${LICENSE_URL}
      - KETTLE_HOME=${PENTAHO_HOME}
      - PENTAHO_HOME=/home/pentaho/


    command: [ "sh", "./pan.sh", "/file:/opt/pentaho/data-integration/samples/transformations/Getting Started Transformation.ktr" ]
